import e from"fs";function a({action:a},{env:t,logger:s}){const c={information_general:"/items/information_general",page_accueil:"/items/page_accueil",page_la_meute:"page_la_meute",page_spectacles:"/items/page_spectacles",page_agenda:"/items/page_agenda",page_galerie:"/items/page_galerie",page_contact:"/items/page_contact",nos_spectacles:"/items/nos_spectacles",date_de_spectacles:"/items/date_de_spectacles",les_artistes:"/items/les_artistes"},i=["items.create","items.update","items.delete"],r=process.env.NEXT_CACHE_SECRET??e.readFileSync("/run/secrets/LESDEMUSELEES-UAT-NEXT_CACHE_SECRET","utf8").trim(),o=async e=>{try{console.log(`[CACHE] Purge de la clé "${e}" ${t.NEXTJS_URL}/api/clear-cache`);const a=await fetch(`${t.NEXTJS_URL}/api/clear-cache`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({key:e})}),c=await a.json();a.ok?s.info(`[CACHE] Clé "${e}" purgée avec succès`):s.warn(`[CACHE] Échec purge clé "${e}" : ${c.message}`)}catch(a){s.error(`[CACHE] Erreur lors de la purge "${e}" : ${a.message}`)}};for(const e of i)a(e,(async({collection:e})=>{const a=c[e];a&&await o(a)}))}export{a as default};
